<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	<!-- 해당 부분의 namespace는 project package + Mapper Package + Mapper Interface 이름입니다. -->
<mapper namespace="systemNoticeMapper">
	<!-- 해당 부분의 id는 MapperClass의 함수 이름과 유사하여야 합니다. -->	
	
	<select id="selectSystemNoticeList" resultType="com.notice.VO.moreNoticeInfoVO" >
		<![CDATA[
			SELECT	*
			  FROM	(
						SELECT	ROWNUM	as RNUM
							 ,	main.*	
						  FROM	(
									SELECT	/*+ ordered use_nl(sn) INDEX_DESC(sn SYSTEMNOTICE_IDX) */
										sn.SYSTEM_NOTICE_CODE							as	systemNoticeCode
										,	sn.TITLE 									as 	systemNoticeTitle
										,	(SELECT ui.USER_ID	
										     FROM   USER_INFO ui
											 WHERE  ui.USER_CODE   =   sn.RGSTUS_ID)    as	systemNoticeRgstusId
										,	TO_CHAR(sn.RGDT_DT, 'YYYY-MM-DD HH24:MI') 	as 	systemNoticeTime
										,	sn.BOARD_COUNT								as	boardCount
									FROM	SYSTEM_NOTICE sn
									WHERE	sn.USE_YN			=	'Y'
			]]>
									<if test='searchSystemNoticeRgstusId != ""'>
											AND	sn.RGSTUS_ID			IN	(SELECT	ui2.USER_CODE
 																			 FROM	USER_INFO ui2
																	 		 WHERE	ui2.USE_YN	=	'Y'
																		 		AND	ui2.USER_ID	LIKE	'%'	||	#{searchSystemNoticeRgstusId} || '%'
																			)
									</if>
									<if test='searchSystemNoticeTitle != ""'>
											AND	sn.TITLE	LIKE	'%'	||	#{searchSystemNoticeTitle} || '%'
									</if>
		<![CDATA[
								) main 
						  WHERE ROWNUM <= #{last}
					)
			WHERE	RNUM >= #{first}
		]]>
	</select>
	
	<insert id="insertSystemNotice"> 
		<selectKey keyProperty="systemNoticeCode" resultType="String" order="BEFORE">
			SELECT	('SYSNOTICE_' || LPAD(systemnotice_seq.nextval,8,0))	FROM 	DUAL    
		</selectKey>
	
		<![CDATA[
			INSERT 
			INTO	SYSTEM_NOTICE
				(	
					SYSTEM_NOTICE_CODE
				,	TITLE
				,	SYSTEM_NOTICE_DESC
				,	RGSTUS_ID
				,	RGDT_DT
				,	UPDT_DT
				,	USE_YN
				)  
			VALUES	
				(	
					#{systemNoticeCode}
				,	#{systemNoticeTitle}
				,	#{systemNoticeDesc}
				,	#{systemNoticeRgstusId}
				,	sysdate
				,	sysdate
				,	'Y'
				)
		]]>
	</insert>
	
	<delete id="deleteSystemNotice"> 
		<![CDATA[
			UPDATE SYSTEM_NOTICE
			SET USE_YN	=	'N'
			WHERE	SYSTEM_NOTICE_CODE	=	#{noticeCode}
		]]>
	</delete>
	
	<select id="selectSystemNoticeListToCnt" resultType="int">
		<![CDATA[
			SELECT	COUNT(*)
			FROM	SYSTEM_NOTICE
			WHERE	SYSTEM_NOTICE.USE_YN			=	'Y'
		]]>
		<if test='searchSystemNoticeRgstusId != ""'>
				AND	SYSTEM_NOTICE.RGSTUS_ID	IN		(SELECT	USER_INFO.USER_CODE
													 	FROM	USER_INFO
													 	WHERE	USER_INFO.USE_YN	=	'Y'
													 	AND	USER_INFO.USER_ID	LIKE	'%'	||	#{searchSystemNoticeRgstusId} || '%'
													)
		</if>
		<if test='searchSystemNoticeTitle != ""'>
				AND	SYSTEM_NOTICE.TITLE	LIKE	'%'	||	#{searchSystemNoticeTitle} || '%'
		</if>
	</select>
	
	<select id="selectSystemNoticeInfoDetail" parameterType="String" resultType="com.notice.VO.moreNoticeInfoVO">
		<![CDATA[
			SELECT	SYSTEM_NOTICE.SYSTEM_NOTICE_CODE 	as systemNoticeCode
				 ,	SYSTEM_NOTICE.TITLE 				as systemNoticeTitle
				 ,	SYSTEM_NOTICE.SYSTEM_NOTICE_DESC 	as systemNoticeDesc
				 ,	SYSTEM_NOTICE.BOARD_COUNT  			as systemNoticeBoardCount
				 ,	SYSTEM_NOTICE.UPDT_DT				as systemNoticeUpdateTime
				 ,	USER_INFO.USER_ID 					as systemNoticeRgstusId
				 ,	USER_INFO.USER_CODE 				as systemNoticeRgstusCode
			FROM	SYSTEM_NOTICE,
					USER_INFO
			WHERE	USER_INFO.USER_CODE		=	SYSTEM_NOTICE.RGSTUS_ID
				AND	SYSTEM_NOTICE.SYSTEM_NOTICE_CODE	=	#{systemNoticeCode}
		]]>
	</select>
	
	<update id="reviseSystemNotice">
		<![CDATA[
			UPDATE 	SYSTEM_NOTICE
			SET		TITLE				=	#{systemNoticeTitle}
				,	SYSTEM_NOTICE_DESC	=	#{systemNoticeDesc}
				,	UPDT_DT				=	sysdate
			WHERE	SYSTEM_NOTICE.SYSTEM_NOTICE_CODE	=	#{systemNoticeCode}
		]]>
	</update>
	
	<update id="updateSystemNoticeCnt">
		<![CDATA[
			UPDATE	SYSTEM_NOTICE
			SET		BOARD_COUNT	=	BOARD_COUNT+1
			WHERE	SYSTEM_NOTICE_CODE	=	#{code}
		]]>
	</update>
</mapper>