<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	<!-- 해당 부분의 namespace는 project package + Mapper Package + Mapper Interface 이름입니다. -->
<mapper namespace="messageMapper">
	<!-- 해당 부분의 id는 MapperClass의 함수 이름과 유사하여야 합니다. -->	
	
	<delete id="deleteMessage"> 
		<![CDATA[
			UPDATE USER_MESSAGE
			SET USE_YN_TO	=	'N'
			WHERE	MESSAGE_CODE	=	#{messageCode}
		]]>
	</delete>
	
	<delete id="deleteSendMessage"> 
		<![CDATA[
			UPDATE USER_MESSAGE
			SET USE_YN_FROM	=	'N'
			WHERE	MESSAGE_CODE	=	#{messageCode}
		]]>
	</delete>
	
	<insert id="sendMessage"> 
		<![CDATA[
			INSERT 
			INTO	USER_MESSAGE
				(	
					MESSAGE_CODE
				,	USER_CODE_FROM
				,	USER_CODE_TO
				,	MESSAGE_TITLE
				,	MESSAGE_DESC
				,	MESSAGE_TIME
				,	USE_YN_TO
				,	USE_YN_FROM
				)  
			VALUES	
				(	
					('MESSAGE_' || LPAD(message_seq.nextval,8,0))
				,	#{userCodeFrom}
				,	(	SELECT USER_CODE
						FROM USER_INFO
						WHERE USER_ID = #{userCodeTo}
					)
				,	#{messageTitle}
				,	#{messageDesc}
				,	sysdate
				,	'Y'
				,	'Y'
				)
		]]>
	</insert>
	 
	<select id="selectMessageList" resultType="com.message.VO.messageInfoVO" parameterType="String"> 
		<![CDATA[
			SELECT	(	SELECT USER_ID
						FROM USER_INFO
						WHERE USER_INFO.USER_CODE	=	USER_MESSAGE.USER_CODE_FROM
					)	as userCodeFrom
			 ,	USER_MESSAGE.MESSAGE_CODE 	as messageCode
			 ,	USER_MESSAGE.MESSAGE_TITLE 	as messageTitle
			 ,	USER_MESSAGE.MESSAGE_DESC 	as messageDesc
			 ,	TO_CHAR(USER_MESSAGE.MESSAGE_TIME, 'YYYY-MM-DD HH24:MI') 	as messageTime
		FROM	USER_MESSAGE
		WHERE	USER_MESSAGE.USER_CODE_TO		=	#{userCode}
			AND	USER_MESSAGE.USE_YN_TO			=	'Y'
		]]>
	</select>
	
	<select id="selectSendMessageList" resultType="com.message.VO.messageInfoVO" parameterType="String"> 
		<![CDATA[
			SELECT	(	SELECT USER_ID
						FROM USER_INFO
						WHERE USER_INFO.USER_CODE	=	USER_MESSAGE.USER_CODE_TO
					)	as userCodeTo
			 ,	USER_MESSAGE.MESSAGE_CODE 	as messageCode
			 ,	USER_MESSAGE.MESSAGE_TITLE 	as messageTitle
			 ,	TO_CHAR(USER_MESSAGE.MESSAGE_TIME, 'YYYY-MM-DD HH24:MI') 	as messageTime
		FROM	USER_MESSAGE
		WHERE	USER_MESSAGE.USER_CODE_FROM		=	#{userCode}
			AND	USER_MESSAGE.USE_YN_FROM		=	'Y'
		]]>
	</select>
	
	<select id="selectMessageInfoDetail" resultType="com.message.VO.messageInfoVO">
		<![CDATA[
			SELECT	(	SELECT USER_ID
						FROM USER_INFO
						WHERE USER_INFO.USER_CODE	=	USER_MESSAGE.USER_CODE_TO
					)	as userCodeTo
			 ,		(	SELECT USER_ID
						FROM USER_INFO
						WHERE USER_INFO.USER_CODE	=	USER_MESSAGE.USER_CODE_FROM
					)	as userCodeFrom
			 ,	USER_MESSAGE.MESSAGE_CODE 	as messageCode
			 ,	USER_MESSAGE.MESSAGE_TITLE 	as messageTitle
			 ,	USER_MESSAGE.MESSAGE_DESC	as messageDesc
			 ,	TO_CHAR(USER_MESSAGE.MESSAGE_TIME, 'YYYY-MM-DD HH24:MI') 	as messageTime
		FROM	USER_MESSAGE
		WHERE	USER_MESSAGE.MESSAGE_CODE		=	#{messageCode}
		]]>
	</select>
	
	<select id="selectUserExistCount" resultType="int">
		<![CDATA[
			SELECT	COUNT(*)
			FROM	USER_INFO
			WHERE	USER_ID		=	#{userId}
				AND	USE_YN		=	'Y'
		]]>
	</select>
	
</mapper> 