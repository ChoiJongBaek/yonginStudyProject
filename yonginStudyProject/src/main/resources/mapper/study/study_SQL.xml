<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	<!-- 해당 부분의 namespace는 project package + Mapper Package + Mapper Interface 이름입니다. -->
<mapper namespace="studyMapper">
	<!-- 해당 부분의 id는 MapperClass의 함수 이름과 유사하여야 합니다. -->	
	<select id="selectSameStudyName" resultType="int" parameterType="string">
		<![CDATA[
			SELECT	COUNT(*)
			FROM	STUDY_INFO
			WHERE	STUDY_NAME		=	#{studyName}
		]]>
	</select>
	
	<insert id="insertStudy"> 
		<![CDATA[
			INSERT 
			INTO	STUDY_INFO
				(	STUDY_CODE
				,	STUDY_NAME
				,	STUDY_DESC
				,	STUDY_TOPIC
				,	STUDY_LIMIT
				,	STUDY_RGSTUS_ID
				,	STUDY_AREA
				) 
			VALUES	
				(	('STUDY_' || LPAD(study_seq.nextval,8,0))
				,	#{studyName}
				,	#{studyDesc}
				,	#{studyTopic}
				,	#{studyLimit}
				,	#{studyRgstusId}
				,	#{studyArea}
				)
		]]>
	</insert>
	
	<select id="selectStudyList" resultType="com.main.VO.studyInfoVO"> 
		<![CDATA[
			SELECT	STUDY_INFO.STUDY_CODE 	as studyCode
			 ,	STUDY_INFO.STUDY_NAME 	as studyName
			 ,	STUDY_INFO.STUDY_DESC 	as studyDesc
			 ,	(	SELECT CODE_VALUE
			 		FROM COMMON_CODE_DETAIL
			 		WHERE COMMON_CODE_DETAIL.CODE_ID	=	STUDY_INFO.STUDY_TOPIC
			 	)	as studyTopic
			 ,	(SELECT CODE_VALUE
			 	 FROM COMMON_CODE_DETAIL
			 	 WHERE COMMON_CODE_DETAIL.CODE_ID	=	STUDY_INFO.STUDY_LIMIT
			 	 ) 	as studyLimit
			 ,	(SELECT CODE_VALUE
			 	 FROM COMMON_CODE_DETAIL
			 	 WHERE COMMON_CODE_DETAIL.CODE_ID	=	STUDY_INFO.STUDY_AREA
			 	 )	as studyArea
			 ,	USER_INFO.USER_NAME 	as userName
			 ,	(SELECT	COUNT(*)		
			 	FROM	USER_IN_STUDY
			 	WHERE	USER_IN_STUDY.STUDY_CODE	=	STUDY_INFO.STUDY_CODE)	as totalCount
		FROM	STUDY_INFO,
				USER_INFO
		]]>
	</select>
	
	<select id="selectStudyInfoDetail" parameterType="String" resultType="com.main.VO.studyInfoVO">
		<![CDATA[
			SELECT	STUDY_INFO.STUDY_CODE 	as studyCode
				 ,	STUDY_INFO.STUDY_NAME 	as studyName
				 ,	STUDY_INFO.STUDY_DESC 	as studyDesc
				 ,	STUDY_INFO.STUDY_TOPIC  as studyTopic
				 ,	STUDY_INFO.STUDY_LIMIT	as studyLimit
				 ,	STUDY_INFO.STUDY_AREA	as studyArea
				 ,	USER_INFO.USER_NAME 	as studyRgstusId
				 ,	USER_INFO.USER_CODE 	as studyRgstusCode
				 ,	(SELECT	COUNT(*)		
				 	 FROM	USER_IN_STUDY
				 	 WHERE	USER_IN_STUDY.STUDY_CODE	=	STUDY_INFO.STUDY_CODE)	as totalCount
			FROM	STUDY_INFO,
					USER_INFO
			WHERE	USER_INFO.USER_CODE		=	STUDY_INFO.STUDY_RGSTUS_ID
				AND	STUDY_INFO.STUDY_CODE	=	#{studyCode}
		]]>
	</select>
</mapper> 